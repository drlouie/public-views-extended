#!/usr/bin/perl5 -s

#	GNU GPL Copyright 2002 - Gavin Laking
#
#	This file is part of Daisy.
#
#	Daisy is free software; you can redistribute it and/or modify
#	it under the terms of the GNU General Public License as published by
#	the Free Software Foundation; either version 2 of the License, or
#	(at your option) any later version.
#
#	Daisy is distributed in the hope that it will be useful,
#	but WITHOUT ANY WARRANTY; without even the implied warranty of
#	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#	GNU General Public License for more details.
#
#	You should have received a copy of the GNU General Public License
#	along with Daisy; if not, write to the Free Software
#	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA

$| = 1;

print "Content-type: text/html\n\n";

require("parse_query.nsp");

require 'common2005.htm';

#require 'getBanner.nsp';

&openDatabase;

$messagecount = 0;
$threadcount = 0;

if ($FORM{'nextOne'}) { $parseCount = $FORM{'nextOne'} * $maxdisplay; $nextInline = $FORM{'nextOne'} + 1; }
else { $parseCount = $maxdisplay; $nextInline = 2; }


for ($a = 0; $a < @messages; $a++) {
	($mnum[$a],$msub[$a],$mfollow[$a],$mname[$a],$memail[$a],$mdate[$a],$mip[$a],$magent[$a],$mresource[$a],$murl[$a],$chop) = split(/``/,$messages[$a]);
	$messagecount++;

	if ($mfollow[$a] == 1) {
		$threadcount++;
	}
}

$AppTitle = "Night Vision Online Forum";

## read cut line count + current message count
$countfile = "cutData.nsf";
open(COUNT,"$countfile") || &error('can not write to $countfile');
$countme = <COUNT>;
close(COUNT);

@counts = split(/:::::/,$countme);
$mcount = $counts[0];
$tcount = $counts[1];
$MCReal = $mcount + $messagecount;
$TCReal = $tcount + $threadcount;


&thyHeader;


## Snif cookie, if present test for username, fname, lname info...
require ("bcookiesnif.nsp");

$myInstructions = "You have selected to post a new message. Please complete all required(<font class='star1'>*</font>) fields in the following form.<br><br><font class='star1'>Challenge Code:</font> It allows us to block automated message posting, the likes of spammers, advertisers and rouge users. You must enter the challenge code (<font class='star1' style='font-weight:normal;'>in lower case</font>) into the challenge field properly, otherwise you will not be allowed to post your message.<br><br>Please remember to be kind towards others, post messages that respect your feelings as well as those of other users. Don't post messages soliciting business, we offer you a place for you to legally advertise your business. Never reply to a message for the sole purpose of ranting about someone else's post, for this type of posts can get you banned from the system.<br><br>Most of all, Have fun and enjoy your stay...";

$leForm = `cat gui/form2005.inc`;



#if ($ENV{'REMOTE_ADDR'} eq "76.175.8.100") {


	
	require("gesichtDeEsel.nsp");

	$elImagen = '<span style="border:#D7A368 1px solid;padding:1px;margin-bottom:1px;"><img src="/besameDiesesEsel/' . $myImagen . '.jpg" width="196" style="Filter: Gray;"></span>';
	$elCompromiso = '<input type="hidden" name="gesicht" value="Esel">';
	$theChallenge = '<input type="hidden" name="simple" value="' . $myImagen . '">';
	$acquireChallenge = '<input class="commonInput" type="text" maxlength="6" size="10" style="margin-top:5px;" onfocus="this.style.backgroundColor=\'#D7A368\';" onblur="this.style.backgroundColor=\'#CCCCCC\';" name="challenger" value="">' . $elCompromiso . '';
	

	
	$nuestroChallenge = "<tr style=\"height:8px;\"><td align=\"center\"><font style=\"font-size:6px; letter-spacing:10px; color:#D7A368\">CHALLENGE CODE</font></td><td><font style=\"font-size:1px;\">&nbsp;</font></td></tr><tr><td align='right'>$elImagen $theChallenge</td><td align='left' valign='middle'><font class='commonText' style='line-height:16px;'><center>Type your 'challenge code' <br>below to \"Post Message\"</center></font>$acquireChallenge</td></tr>";
	$leForm =~ s/%%CHALLENGER%%/$nuestroChallenge/g;	
	
	
#}

#else {
#	$leForm =~ s/%%CHALLENGER%%//g;	
#}

print qq~

<script language="Javascript" src="js/b4dom.js"></script>
<script language="Javascript" src="js/mousetable.js"></script>
<LINK REL="STYLESHEET" HREF="common_css2005.css" Type="text/css">


<table width="100%" align="center" border="0" cellpadding="0" cellspacing="0">
  <tr> 
    <td width="100%" align="right" valign="top" height="94"><img src="images2005/newTopper_left.jpg" width="396" height="94"></td>
    <td width="333" align="left" valign="top" height="94"><img src="images2005/newTopper_mid_postnew.jpg" width="333" height="94"></td>
  </tr>
</table>
<table width="100%" align="center" border="0" cellpadding="0" cellspacing="0">
				<tr valign="top">
					<td height="20" colspan="5"><img src="images2005/spacer.gif" border="0" height="20"></td>
				</tr>
	<tr>
		<td width="15"><img src="images2005/spacer.gif" width="15" height="10" border="0"></td>
		<td width="100%" align="center" valign="top">
<form action="postMessage2005.htm?action=postMessage&follow=no" method="post" name="bbsform" onSubmit="return validateInfo();">
<input type="hidden" name="follow" value="no">



~;

if ($Cookies{'Entrado'} eq "YES") {
	$leName = "$Cookies{'Boozer'}";
	$muaName = "value=\"$Cookies{'Boozer'}\" readonly";
	$muaEmail = "value=\"$Cookies{'Amil'}\" readonly";
	$muaEmail =~ s/\[AT\]/@/g;
	$muaMessage = "You last posted a message on $Cookies{'LP'} ";
}

$leForm =~ s/%%leName%%/$leName/g;
$leForm =~ s/%%Muaname%%/$muaName/g;
$leForm =~ s/%%Muaemail%%/$muaEmail/g;
$leForm =~ s/%%Muamessage%%/$muaMessage/g;

$leForm =~ s/%%MyInstructions%%/$myInstructions/g;


print qq~

$leForm



</form> 
		</td>
		<td width="15"><img src="images2005/spacer.gif" width="15" height="10" border="0"></td>
	</tr>
</table>

~;



	print "</body></html>";
	exit;