#!/usr/bin/perl5 -s

$| = 1;

require("parse_query.nsp");
require("common2008.htm");
require("bcookiesnif.nsp");

##-- parse panel bar
$panelBar = 1;
require("pm.nsp");

use DBI;
use locale;
use Text::Autoformat;
autoformat;

&openDatabase;

$messagecount = 0;
$threadcount = 0;

if ($customMetas ne "") { $maxdisplay = 20; }
else { $maxdisplay = 25; }

if ($FORM{'numPages'}) { $maxdisplay = $FORM{'numPages'}; $myLoad1 = "toggleForumTab1();"; }
else { $maxdisplay = $maxdisplay; $myLoad1 = ""; }

if ($FORM{'nextOne'}) {
	$parseCount = ($FORM{'nextOne'} * $maxdisplay) - 1;
	$nextInline = $FORM{'nextOne'} + 1;
	if ($myLoad1 eq "") { $myLoad2 = "toggleForumTab2();"; }
	else { $myLoad2 = ""; }
}
else { $parseCount = ($maxdisplay - 1); $nextInline = 2; $myLoad2 = ""; }

if ($FORM{'showAll'}) {
	$showAll = "&showAll=YES";
	if ($myLoad1 eq "" && $myLoad2 eq "") { $myLoad3 = "toggleForumTab1();"; }
	else { $myLoad3 = ""; }
}
else { $showAll = ""; $myLoad3 = ""; }

if ($FORM{'thyQuery'}) {
	if ($FORM{'thyQuery'} =~ ",") {
		@splitQ = split(/,/,$FORM{'thyQuery'});
		$FORM{'thyQuery'} = "$splitQ[0]";
	}
	else {
		$FORM{'thyQuery'} = "$FORM{'thyQuery'}";
	}
	$myQuery = "SEEKING: $FORM{'thyQuery'}";
	$GOSEARCH = "1";
	$myResearchField = "<input type=\"hidden\" name=\"thyQuery\" value=\"$FORM{'thyQuery'}\">";
	$reSearch = "&thyQuery=$FORM{'thyQuery'}";
	if ($myLoad1 eq "" && $myLoad2 eq "" && $myLoad3 eq "") { $myLoad4 = "toggleForumTab3();"; }
	else { $myLoad4 = ""; }
}
else {
	$GOSEARCH = "0";
	$myQuery = "";
	$myLoad4 = "";
	$myResearchField = "";
	$reSearch = "";
}


if ($Cookies{'Entrado'}) { $adLoad = "showAdvert();"; }
else { $adLoad = ""; }

## IF SEARCHING
if ($GOSEARCH == "1") {
	foreach $unMensage (@messages) { if ($unMensage =~ "$FORM{'thyQuery'}") { push(@messagesReal,$unMensage); } }
}
else {
	foreach $unMensage (@messages) { push(@messagesReal,$unMensage); }
}

for ($a = 0; $a < @messagesReal; $a++) {
	($mnum[$a],$msub[$a],$mfollow[$a],$mname[$a],$memail[$a],$mdate[$a],$mip[$a],$magent[$a],$mresource[$a],$murl[$a],$chop) = split(/``/,$messagesReal[$a]);
	$messagecount++;

	if ($mfollow[$a] == 1) {
		$threadcount++;
	}
}

$AppTitle = "Night Vision Online Forum";

	if ($parseCount == $maxdisplay - 1) { $myPager = "Live Forum - Active Thread"}
	else { $myPage = $nextInline - 1; $myPager = "Archived Forum - Page $myPage" }

	$BROWSER = "$ENV{'HTTP_USER_AGENT'}";
	if ($BROWSER =~ "Netscape") { $MuaSpeed = "20"; }
	else { $MuaSpeed = "5"; }

	if (!$FORM{'nextOne'} && !$FORM{'thyQuery'}) { $cualTopper = "newTopper_mid_home.jpg"; }
	elsif ($FORM{'nextOne'} == "1" && !$FORM{'thyQuery'}) { $cualTopper = "newTopper_mid_home.jpg"; }
	elsif ($FORM{'thyQuery'} ne "") { $cualTopper = "newTopper_mid_search.jpg"; }
	else { $cualTopper = "newTopper_mid_bypage.jpg"; }

	$pagecount=1;


	
($FORM{'nextOne'}) = split(/, /,$FORM{'nextOne'});
if ($FORM{'numPages'}) { $leNumPages = "&numPages=$FORM{'numPages'}"; }
	for ($b = 0; $b < @messagesReal;) {
		$b = $b+$maxdisplay;
		if ($b ne $parseCount) {
			if ($FORM{'nextOne'} == "$pagecount") { push(@allOthers,"<option value=\"index2008.htm?nextOne=$pagecount$leNumPages$showAll$reSearch\" SELECTED>$pagecount</option>"); }
			else { push(@allOthers,"<option value=\"index2008.htm?nextOne=$pagecount$leNumPages$showAll$reSearch\">$pagecount</option>"); } 
			$pagecount++;
		}
	}
	$prevPage = $nextInline - 2;

	##-- true total PAGE COUNT
	$tLP = int($pagecount - 1);

	##-- if first page is being shown
	if ($FORM{'nextOne'} eq "" || $FORM{'nextOne'} eq "1" || $FORM{'nextOne'} eq "0") { 
		$FORM{'nextOne'} = '1';
		$miFP = "<img src=\"/nvi/pagingButtons_firstOff.gif\" width=\"16\" height=\"12\" border=\"0\" name=\"first\" title=\"<< First Page\">"; 
		$miPP = "<img src=\"/nvi/pagingButtons_prevOff.gif\" width=\"16\" height=\"12\" border=\"0\" name=\"prev\" title=\"< Previous Page\">"; 
	}
	else { 
		$miFP = "<a href=\"index2008.htm?nextOne=1$leNumPages$showAll$reSearch\"><img src=\"/nvi/pagingButtons_firstOn.gif\" width=\"16\" height=\"12\" border=\"0\" name=\"first\" title=\"<< First Page\"></a>"; 
		$miPP = "<a href=\"index2008.htm?nextOne=$prevPage$leNumPages$showAll$reSearch\"><img src=\"/nvi/pagingButtons_prevOn.gif\" width=\"16\" height=\"12\" border=\"0\" name=\"prev\" title=\"< Previous Page\"></a>"; 
	}
	

	##-- if last page being shown
	if ($FORM{'nextOne'} == "$tLP") { 
		$miLP = "<img src=\"/nvi/pagingButtons_lastOff.gif\" width=\"16\" height=\"12\" border=\"0\" name=\"last\" title=\"Last Page >>\">"; 
		$miNP = "<img src=\"/nvi/pagingButtons_nextOff.gif\" width=\"16\" height=\"12\" border=\"0\" name=\"next\" title=\"Next Page >\">";
	}
	else { 
		$miLP = "<a href=\"index2008.htm?nextOne=$tLP$leNumPages$showAll$reSearch\"><img src=\"/nvi/pagingButtons_lastOn.gif\" width=\"16\" height=\"12\" border=\"0\" name=\"last\" title=\"Last Page >>\"></a>"; 
		$miNP = "<a href=\"index2008.htm?nextOne=$nextInline$leNumPages$showAll$reSearch\" style=\"font-size:12px; font-family:verdana,arial,helvetica; color: #000000;\"><img src=\"/nvi/pagingButtons_nextOn.gif\" width=\"16\" height=\"12\" border=\"0\" name=\"next\" title=\"Next Page >\"></a>";
	}

	$paginSelect = "<select name=\"GoToPages\" onChange=\"location.href=this.options[this.selectedIndex].value;\" class=\"numPages\">@allOthers</select>";
	
	$pagin = "$miFP &nbsp;&nbsp; $miPP &nbsp;&nbsp; showing page $paginSelect of $tLP &nbsp;&nbsp; $miNP &nbsp;&nbsp; $miLP"; 


	
	
	
	

print qq~
<html>
<head>
$myHead
<style>
	body { overflow-x:hidden; overflow-y:auto; scrollbar-face-color:#CCCCCC; scrollbar-highlight-color:#000000; scrollbar-shadow-color:#CCCCCC; scrollbar-3dlight-color: #000000; scrollbar-arrow-color:#000000; scrollbar-track-color:#000000; scrollbar-darkshadow-color:#000000; }
	.formInput { font-size: 10px; font-family:verdana,arial,helvetica; border: #626062 1px solid; height:20px; background-color:#101E06;color:#F7F7F7; padding: 3px; font-weight:normal; }
	.formTA { font-size: 10px; font-family:verdana,arial,helvetica; border: #626062 1px solid; height:60px; background-color:#101E06; color:#F7F7F7; padding: 3px; font-weight:normal; }
	.formSelect { font-size: 10px; font-family:verdana,arial,helvetica; border: #626062 1px solid; height:20px; background-color:#101E06; color:#F7F7F7; padding: 3px; font-weight:normal; }
	#overDiv,#divLinks,#divArrows, #bground, #divLoad, #divCont, #divIEText, #addCommentForm { position:absolute;left:0px;top:0px;z-index:-100;visibility:hidden;width:1px; height:1px;overflow:hidden; }
</style>
<LINK REL="STYLESHEET" HREF="commonStyles.css" Type="text/css">
<script language="Javascript" src="js/b4dom.js"></script>
<script language="Javascript" src="js/mousetable.js"></script>
<script language="Javascript">
var theCB = 0;
var countT = 0;
function trigger(myurl) {
	var myurl = myurl;

	if (myurl.indexOf("?") != -1) {
		if (countT != 0) { theCB = '&CB=' + countT + ''; }
		frame.loadpage(''+myurl+'&'+theCB+'');
		countT++;
	}
	else {
		frame.loadpage(''+myurl+'');
	}

}

function hoverTD(who,whoElse) {
	who.style.background = '#23390D';
	who.style.color = '#D6D6D6';
	miElse1 = ""+whoElse+"1";
	miElse2 = ""+whoElse+"2";
	miElse3 = ""+whoElse+"3";
	if (document.getElementById(""+miElse1+"")) {
		document.getElementById(""+miElse1+"").style.background = '#23390D';
		document.getElementById(""+miElse1+"").style.color = '#D6D6D6';
		if (document.getElementById(""+miElse2+"")) {
			document.getElementById(""+miElse2+"").style.background = '#23390D';
			document.getElementById(""+miElse2+"").style.color = '#D6D6D6';
		}
		if (document.getElementById(""+miElse3+"")) {
			document.getElementById(""+miElse3+"").style.background = '#23390D';
			document.getElementById(""+miElse3+"").style.color = '#D6D6D6';
		}
	}
}
function backTD(who,whoElse,backbg) {
	who.style.background = ''+backbg+'';
	who.style.color = '#000000';
	miElse1 = ""+whoElse+"1";
	miElse2 = ""+whoElse+"2";
	miElse3 = ""+whoElse+"3";
	if (document.getElementById(""+miElse1+"")) {
		document.getElementById(""+miElse1+"").style.background = ''+backbg+'';
		document.getElementById(""+miElse1+"").style.color = '#000000';
		if (document.getElementById(""+miElse2+"")) {
			document.getElementById(""+miElse2+"").style.background = ''+backbg+'';
			document.getElementById(""+miElse2+"").style.color = '#000000';
		}
		if (document.getElementById(""+miElse3+"")) {
			document.getElementById(""+miElse3+"").style.background = ''+backbg+'';
			document.getElementById(""+miElse3+"").style.color = '#000000';
		}
	}
}

function checkSearch(cual) {
	var daValue = cual.value;
	if (daValue == "$myQuery") { cual.value = ""; }
}

function escupeLaPanel() {
	// trigger("loadPB.htm");
	trigger("newsL.htm");
}
</script>

<!-- START NEWS-->
<script>
var lasNuevas = new Array();
var lasWiki = new Array();

var newsC = 5;
var todosNews = 0;
function moreNews() {
	// less than 20 or as many available if less
	if (newsC < todosNews) {
		currINNER = ""+ document.getElementById("news").innerHTML +"";
		document.getElementById("news").innerHTML = ""+ currINNER +""+ lasNuevas[newsC] +"";
		newsC++;
	}
}
function lessNews() {
	// less than 20 or as many available if less
	var nuevasNuevas = '';
	if (newsC > 2) {
		document.getElementById("news").innerHTML = '';

		newsC--;
		i = 1;
		while (i < newsC) {
			nuevasNuevas = nuevasNuevas + "" + lasNuevas[i];
			i++;
		}
		document.getElementById("news").innerHTML = ""+ nuevasNuevas +"";
	}

}



var wikiC = 6;
var todosWiki = 0;
function moreWiki() {
	// less than 20 or as many available if less
	if (wikiC < todosWiki) {
		currINNERw = ""+ document.getElementById("wiki").innerHTML +"";
		document.getElementById("wiki").innerHTML = ""+ currINNERw +""+ lasWiki[wikiC] +"";
		wikiC++;
	}
}
function lessWiki() {
	// less than 20 or as many available if less
	var nuevasWiki = '';
	if (wikiC > 2) {
		wikiC--;
		i = 1;
		while (i < wikiC) {
			nuevasWiki = nuevasWiki + "" + lasWiki[i];
			i++;
		}
		document.getElementById("wiki").innerHTML = ""+ nuevasWiki +"";
	}

}

</script>
<!--END NEWS-->
</head>
<body style="background-color:#FFFFFF" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<div id="overLibDiv" style="position:absolute; visibility:hidden; z-index:1000;"></div>
<script language="JavaScript" src="js/overlib.js"></script>
<div id="overDiv"></div><div id="divLinks"></div><div id="divArrows"></div>
<script language="Javascript">
	var ovFGColor = "#F0F0F0";
</script>
<script language="JavaScript" src="js/pageload1.js"></script>
<!-- Copyright NetMedia Solutions and USNV-->
<script language="Javascript" src="js/pageload2.js"></script>

				$thaHeader
				<table width="100%" cellpadding="0" cellspacing="0" border="0">
					<tr>
						<td><img src="nvi/spacer.gif" border="0" width="1" height="1"></td>
					</tr>
				</table>

			<!--STARTMainLayoutTable-->
				<table width="100%" cellpadding="0" cellspacing="0" border="0">
					<tr>
						<!--STARTMainContentArea-->
						<td width="100%" valign="top">
~;
	
print qq~


<table width="100%" align="center" border="0" cellpadding="0" cellspacing="0" bgcolor="#D6D6D6">
<form>
	<tr>
		<td width="100%" align="center" valign="top">
				<center>
					<table width="100%" align="center" border="0" cellpadding="0" cellspacing="0">
						<tr>
							<td width="100%" align="center" style="padding-left:5px;padding-right:5px;padding-bottom:30px;" valign="top">
								<table cellpadding="0" align="center" cellspacing="0" border="0">
									<tr valign="middle" height="40">
										<td align="right" class="searchTitle" style="padding-right:20px;" nowrap>Night Vision Search: </td>
										<td align="center" nowrap><input type="text" name="thyQuery" size="30" value="$myQuery" class="search" onFocus="javascript:checkSearch(this)"></td>
										<td align="left" class="instruct" style="padding-left:20px;" nowrap><input type="radio" value="forum" checked> forum</td>
									</tr>
								</table>
								<table width="100%" border="0" cellpadding="0" cellspacing="0" style="border: #3A3A3A 1px solid;">
									<tr>
										<td width="100%" align="center" valign="top">

											<TABLE width="100%" cellpadding="0" align="center" cellspacing="0" border="0">
												<tr valign="top">
													<td width="100%" align="center">
														<table width="100%" border="0" cellpadding="0" cellspacing="0" border="0">
															<tr>
																<td colspan="6" width="100%" align="center" valign="top" bgcolor="#D6D6D6"><div style="width:1px;height:1px;overflow:hidden;clip:rect(0px 1px 1px 0px);"></div></td>
															</tr>
															<tr class="instruct" style="font-family:verdana,arial,helvetica;font-size:9px;color:#A4A4A4;height:21px;" bgcolor="#323232">
																<td colspan="2" style="padding-left:55px;">topic ( discussion )</td>
																<td style="padding-left:10px;">originator</td>
																<td style="padding-left:10px;">replies</td>
																<td style="padding-left:10px;">last post</td>
															</tr>
															<tr>
																<td colspan="6" width="100%" align="center" valign="top" bgcolor="#D6D6D6"><div style="width:1px;height:1px;overflow:hidden;clip:rect(0px 1px 1px 0px);"></div></td>
															</tr>
															<tr>
																<td colspan="6" width="100%" align="center" valign="top" bgcolor="#3A3A3A"><div style="width:1px;height:1px;overflow:hidden;clip:rect(0px 1px 1px 0px);"></div></td>
															</tr>
															<tr>
																<td colspan="6" width="100%" align="center" valign="top" bgcolor="#FFFFFF"><div style="width:1px;height:1px;overflow:hidden;clip:rect(0px 1px 1px 0px);"></div></td>
															</tr>
															<tr>
																<td colspan="6" width="100%" align="center" valign="top" bgcolor="#C0C0C0">
																	<table width="100%" cellpadding="0" align="center" cellspacing="0" border="0">
																		<tr valign="bottom" height="40">
																			<td width="33%" align="left" class="titleForum" style="padding-left:10px;padding-bottom:10px;" nowrap><b>NVO(L)ounge:</b> Night Vision Forum</td>
																			<td width="33%" align="center" class="pagin" style="padding-bottom:12px;" nowrap>$pagin</td>
																			<td width="33%" align="right" nowrap>&nbsp;</td>
																		</tr>
																	</table>
																</td>
															</tr>
															<tr>
																<td colspan="6" width="100%" align="center" valign="top" bgcolor="#3A3A3A"><div style="width:1px;height:1px;overflow:hidden;clip:rect(0px 1px 1px 0px);"></div></td>
															</tr>
~;



@template = "<!--messages-->";

### QUERY DB
	use DBI; 
	my $dbh = DBI->connect('DBI:mysql:NVF','root','32GCC5E7TSjqQ') or die "Unable to connect to database: <b>unvWeb</b>\n"; 
	$dbh->{RaiseError} = 1; 

$myReplies = 0;
$countThrows = $parseCount + $lastSet;
$countItems = 0;
$countTwos = 0;
$elBorder = "#B4B4B4";
$elBorder1 = "#B4B4B4";
$elBorder2 = "#B4B4B4";
	for ($a = 0; $a < @template; $a++) {
		$_ = $template[$a];
		$last = 1;
	    for ($b = 0; $b < @messagesReal; $b++) {

			if ($parseCount == $maxdisplay - 1) { $lastSet = ($parseCount - $maxdisplay); }
			else { $lastSet = ($parseCount - $maxdisplay); }
			if ($countThrows <= $parseCount && $countThrows > $lastSet && $b > $lastSet) {

				$last = $mfollow[$b];

				if ($mname[$b] eq "" || $mname[$b] eq " ") { $muaUsername = "AnonymousUser"; }
				else { $muaUsername = $mname[$b]; }

				@dateTime = split(/ - /, $mdate[$b]);
				@datePieces = split (/\//, $dateTime[0]);
				@timePieces = split(/:/, $dateTime[1]);

				@months = ('','January','February','March','April','May','June','July','August','September','October','November','December');



				if ($datePieces[2] > 50) { $myYear = "19" . $datePieces[2]; }
				else { $myYear = "20" . $datePieces[2]; }

				if ($timePieces[0] > 12) { $timeSet = "PM"; $theHour = $timePieces[0] - 12; }
				elsif ($timePieces[0] == 12) { $timeSet = "PM"; $theHour = $timePieces[0]; }
				elsif ($timePieces[0] < 12) { $timeSet = "AM"; $theHour = $timePieces[0]; }
				$theMinute = $timePieces[1];

				$theHour = sprintf("%02d", $theHour);
				$leCuenta = $b + 1;

				
				my $sth = $dbh->prepare("SELECT PostadoID, MessageStatus FROM leForu WHERE (PostadoID='$mnum[$b]') AND (MessageStatus = 'VeRiFiEd')");
				$sth->execute or die "Sorry, try again.\n"; 
				my $row = $sth->fetchrow_arrayref; 
				my $lePID = $row->[0];
				$sth->finish;
			
				if ($lePID ne "" && $lePID ne "0") {
					$msub[$b] =~ s/"//g;


					if ($mfollow[$b] eq "1") {
						$myReplies++;
						if ($myReplies ne "0" && $countItems ne "0") {
							### printing out NUMBER (count) of replies
							### finding out which reply is the newest reply
							$bigYE = -1;
							$bigMO = -1;
							$bigDA = -1;
							$countEm = 0;
							foreach $MR (@muaReply) {
								@splitReply = split(/-----/,$MR);
								$us = $splitReply[0];
								$mo = $splitReply[1];
								$da = $splitReply[2];
								$ye = $splitReply[3];
								$PID = $splitReply[4];
								$PID = int($PID);
								$Time = $splitReply[5];
								if ($ye >= $bigYE && $mo >= $bigMO && $da >= $bigDA) { 
									if ($Cookies{'Entrado'}) { $sUSER = "<a href=\"fmsgr2008.htm?posterid=$PID\" class=\"instruct\" style=\"font-size:11px;color:#000000;\" title=\"Click to send $us a private e-mail message\" id=\"$mua2\">$us</a>"; }
									else { $sUSER = "$us"; }
									$lastPoster = "$months[$mo] $da, $ye ( $Time ) <br>by $sUSER";
									$countEm++;
								}
							}
						}
	
	
						if ($countItems ne "0") {
							$trueReplies = $myReplies - 1;
							print "$trueReplies</td><td style=\"font-family:arial,verdana;font-size:10px;line-height:16px;padding-left:10px;padding-top:1px;padding-bottom:4px;border-top:$tdBORDER 1px solid;border-left:$elBorder 1px solid;border-right:$elBorder 1px solid;\" nowrap>$lastPoster</td></tr>";
						}


						if(!$myTC) { $myTC = 1; }
						else { $myTC = int($myTC+1); }
						$mua3 = "$myTC" . "3";
						if ($Cookies{'Entrado'}) { $thisUSER = "<a href=\"fmsgr2008.htm?posterid=$mnum[$b]\" class=\"instruct\" style=\"font-size:11px;color:#000000;\" title=\"Click to send $muaUsername a private e-mail message\" id=\"$mua3\">$muaUsername</a>"; }
						else { $thisUSER = "$muaUsername"; }
	
						$countTwos++;
						if ($countTwos eq "2") { 
							$countTwos = 0;
							$tdBG = '#868686';
						}
						else { 
							$tdBG = '#9A9A9A';
						}
						
						if ($tdBORDER eq "$elBorder2") { $tdBORDER = $elBorder1; }
						else { $tdBORDER = $elBorder2; }
						
						###- write out bottom border only for last item parsed
						if ($countItems == ($maxdisplay - 1)) {
							$BBOTTOM = "border-bottom:$tdBORDER 1px solid;";
						}
						
						
						$TcountItems = int($countItems + 1);
						$mua1 = "$TcountItems" . "1";
						$mua2 = "$TcountItems" . "2";
						print "
						<tr class=\"commonText\" bgcolor=\"$tdBG\" valign=\"top\" title=\"Click to view or reply to this discussion\" style=\"cursor:hand;\" onClick=\"document.location.href='fdisplay2008.htm?action=display\&num=$mnum[$b]';\" onMouseOver=\"hoverTD(this,'$TcountItems');\" onMouseOut=\"backTD(this,'$TcountItems','$tdBG');\">
							<td align=\"center\" style=\"padding-top:8px;padding-bottom:8px;border-top:$tdBORDER 1px solid; $BBOTTOM border-left:$elBorder 1px solid;color:#000000;\"><a href=\"fdisplay2008.htm?action=display\&num=$mnum[$b]\"><img src=\"nvi/NewRepliesNo.gif\" border=\"0\" width=\"12\" height=\"14\" hspace=\"5\"></a></td>
							<td style=\"padding-left:10px;padding-top:8px;padding-bottom:4px;border-top:$tdBORDER 1px solid; $BBOTTOM border-left:$elBorder 1px solid;color:#000000;\"><a href=\"fdisplay2008.htm?action=display\&num=$mnum[$b]\" class=\"instruct\" style=\"font-size:13px;color:#000000;\" id=\"$mua1\">$msub[$b]</a></td>
							<td style=\"padding-left:10px;padding-top:9px;padding-bottom:4px;border-top:$tdBORDER 1px solid; $BBOTTOM border-left:$elBorder 1px solid;\"><b>$thisUSER</b></td>
							<td align=\"center\" style=\"padding-top:9px;padding-bottom:8px;border-top:$tdBORDER 1px solid; $BBOTTOM border-left:$elBorder 1px solid;font-size:11px;\">
						"; 


						$myReplies = 0;
						@muaReply = "";
						$countThrows = $countThrows - 1;
						$countItems++;
						push(@muaReply,"$muaUsername-----$datePieces[0]-----$datePieces[1]-----$myYear-----$mnum[$b]-----$theHour:$theMinute $timeSet PST");
					}
					else { 
						$myReplies++;
						push(@muaReply,"$muaUsername-----$datePieces[0]-----$datePieces[1]-----$myYear-----$mnum[$b]-----$theHour:$theMinute $timeSet PST");
					}
					$lastPoster = '&nbsp;';
				}
			}
		}
	}

$dbh->disconnect;


### to kill the final one
print "$trueReplies</td><td style=\"border-top:$tdBORDER 1px solid; border-bottom:$tdBORDER 1px solid; border-left:$elBorder 1px solid;border-right:$elBorder 1px solid;\">$lastPoster</td></tr>";

print qq~

															<tr>
																<td colspan="6" width="100%" align="center" valign="top" bgcolor="#3A3A3A"><div style="width:1px;height:1px;overflow:hidden;clip:rect(0px 1px 1px 0px);"></div></td>
															</tr>
															<tr>
																<td colspan="6" width="100%" align="center" valign="top" bgcolor="#D6D6D6"><div style="width:1px;height:1px;overflow:hidden;clip:rect(0px 1px 1px 0px);"></div></td>
															</tr>
															<tr>
																<td colspan="6" width="100%" align="center" valign="top" bgcolor="#C0C0C0">
																	<table width="100%" cellpadding="0" align="center" cellspacing="0" border="0">
																		<tr valign="bottom" height="40">
																			<td width="33%" align="left" class="titleForum" style="padding-left:10px;padding-bottom:10px;" nowrap><b>NVO(L)ounge:</b> Night Vision Forum</td>
																			<td width="33%" align="center" class="pagin" style="padding-bottom:12px;" nowrap>$pagin</td>
																			<td width="33%" align="right" nowrap>&nbsp;</td>
																		</tr>
																	</table>
																</td>
															</tr>
															<tr>
																<td colspan="6" width="100%" align="center" valign="top" bgcolor="#FFFFFF"><div style="width:1px;height:1px;overflow:hidden;clip:rect(0px 1px 1px 0px);"></div></td>
															</tr>
															<tr>
																<td colspan="6" width="100%" align="center" valign="top" bgcolor="#3A3A3A"><div style="width:1px;height:1px;overflow:hidden;clip:rect(0px 1px 1px 0px);"></div></td>
															</tr>
															<tr>
																<td colspan="6" width="100%" align="center" valign="top" bgcolor="#D6D6D6"><div style="width:1px;height:1px;overflow:hidden;clip:rect(0px 1px 1px 0px);"></div></td>
															</tr>
															<tr class="instruct" style="font-family:verdana,arial,helvetica;font-size:9px;color:#A4A4A4;height:21px;" bgcolor="#323232">
																<td colspan="2" style="padding-left:55px;">topic ( discussion )</td>
																<td style="padding-left:10px;">originator</td>
																<td style="padding-left:10px;">replies</td>
																<td style="padding-left:10px;">last post</td>
															</tr>

									</table>

								</td>
							</tr>
						</table>

					</td>
				</tr>
			</table>

		</td>
		<td valign="top" width="154" style="background-image:url(/nvi/panelBarBacker.gif);background-repeat:repeat-y;">
			<table height="100%" width="150" cellpadding="0" align="center" cellspacing="0" border="0">
				<tr valign="top" width="150">
					<td height="46" align="center" nowrap>
						<div id="panelBar" style="padding-top:40px;visiblity:visible;height:46px;position:relative;top:-46px;left:0px;z-index:100;background-image:url(/nvi/panelBarBacker.gif);background-repeat:repeat-y;">
							<div id="PB" style="visiblity:visible;position:relative;top:-30px;left:0px;z-index:101;"></div>
						</div>
					</td>
				</tr>
			</table>
		</td>
		<td width="3"><div style="width:3px;height:1px;overflow:hidden;clip:rect(0px 3px 1px 0px);"></div></td>
	</tr>
</form>
</table>

</center>



		</td>

	</tr>
</table>


~;


print qq~
		</td>
	</tr>
</table>
<script language="Javascript">
	ifrinit();
	setTimeout(escupeLaPanel,100);
</script>
~;

## print out main template BOT from templateMaster.nsp
print $USNVMainTemplateBot;

print "</body></html>";

1;
