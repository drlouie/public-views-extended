#!/usr/bin/perl5 -s

## --> Snif cookie, if present test for logged in status
## --> LOGin not REQuired
$logreq = 0;
require ("cookiesnif.nsp");

require("parse_query.nsp");

$noDateParse = 1;
require ("dateNewest.nsp");

print "Content-type: image/gif\n\n";

$noUP = 0;

@sizes = ("","30x30");
if ($FORM{'size'}) { $iSize = $sizes[$FORM{'size'}]; } else { $iSize = "30x30"; }

$FORM{'myPhoto'} = int($FORM{'myPhoto'}); $FORM{'elPhotoID'} = int($FORM{'elPhotoID'});

if (($CSen eq "SI" && $FORM{'myPhoto'} == 1) || ($FORM{'myPhoto'} == 0 && $FORM{'elPhotoID'} > 0)) {

	if ($FORM{'myPhoto'} == 1) { $phID = $CSin; }
	else { $phID = $FORM{'elPhotoID'}; }

	$userImageGIF = "nvi/up/$iSize/$phID.gif";
	$userImagePNG = "nvi/up/$iSize/$phID.png";
	##-- exists
	if ((-e $userImageGIF) || (-e $userImagePNG)) {
		if ((-e $userImageGIF)) { $CSphoto = `cat $userImageGIF`; }
		if ((-e $userImagePNG)) { $CSphoto = `cat $userImagePNG`; }
		##-- make sure truly a GIF
	   	if (($CSphoto =~ "GIF") || ($CSphoto =~ "PNG")) { $image = "$CSphoto"; }
		else { $noUP = 1; }
	}
	else { $noUP = 1; }

}
else { $noUP = 1; }

if ($noUP == 1) {
	$defImage = "nvi/up/$iSize/noUP.gif";
	##-- just double checking
	if (-e $defImage) {
		$image = `cat $defImage`;
	}
}

print "$image";

exit;