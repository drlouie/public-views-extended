###############
##<-- 2k8 -->##
###############

################################
##<-- parseProductPage.nsp -->##
################################



### QUERY DB
use DBI;
my $dbh = DBI->connect("DBI:mysql:unvWeb","root","19nv8n6uilPoA") or die "Unable to connect to database: <b>unvWeb</b>\n"; 
$dbh->{RaiseError} = 1; 


$whichCART = 'cart.htm';


$countZeros = 0;

$count=0;
my $sth = $dbh->prepare("SELECT * FROM ProductsNEW WHERE ProductID='$PID'");
$sth->execute or die "Unable to execute query\n"; 
my @row;
	while(@row = $sth->fetchrow_array) { 
		$SavedPartNum = $row[0];
		$SavedMFGName = $row[1];
		$SavedMFGProdURL = $row[2];
		$SavedItemName = $row[3];
		$SavedDescription = $row[4];
		$SavedTechSpecs = $row[5];
		$SavedSmallPhoto = $row[6];
		$SavedLargePhoto = $row[7];
		$BrochureBulletPoints = $row[8];
		$SavedWarranty = $row[9];
		$SavedWeight = $row[10];
		$SavedMasterDist = $row[11];
		$SavedDistributor = $row[12];
		$SavedDealer = $row[13];
		$SavedLawEnforce = $row[14];
		$SavedRetail = $row[15];
		$SavedInternational = $row[16];
		$SavedAccessories = $row[17];
		$SavedIncludedItems = $row[18];
		$SavedProdUsage = $row[19];
		$SavedGEN = $row[20];
		$SavedVS = $row[21];
		$SavedOC = $row[22];
		$SavedECOMC = $row[23];
		$SavedBVC = $row[24];
		$SavedBEC = $row[25];
		$SavedLVO = $row[26];
		$SavedProductType = $row[27];
		$SavedBAType = $row[28];
		$SavedACCType = $row[29];
		$SavedSpecialDiscount = $row[30];
		$SavedProductOptions = $row[31];
		$count++;
		push(@sfiles2,"$SavedPartNum $SavedMFGName $SavedMFGPartNum $SavedMFGProdURL $SavedItemName $SavedDescription $SavedTechSpecs $SavedProdUsage $SavedProductType $row[0]" . "\t" . "$row[0]" . "\t" . "$SavedMFGName" . "\t" . "$SavedMFGPartNum" . "\t" . "$SavedMFGProdURL" . "\t" . "$SavedItemName" . "\t" . "$SavedDescription" . "\t" . "$SavedTechSpecs" . "\t" . "$SavedSmallPhoto" . "\t" . "$SavedLargePhoto" . "\t" . "$SavedWarranty" . "\t" . "$SavedWeight" . "\t" . "$SavedMasterDist" . "\t" . "$SavedDistributor" . "\t" . "$SavedDealer" . "\t" . "$SavedLawEnforce" . "\t" . "$SavedRetail" . "\t" . "$SavedAccessories" . "\t" . "$SavedProdUsage" . "\t" . "$SavedProductType");
		if ($SavedWarranty =~ "y" || $SavedWarranty =~ "Y") { $DaWarranty = "$SavedWarranty"; }
		else { $DaWarranty = ""; }
		if ($SavedWarranty ne "" && $SavedWarranty ne " " && $SavedWarranty ne "Null" && $SavedWarranty ne "NULL" && $SavedWarranty ne "null") { $losTSpecs = "$SavedWarranty"; }
		else { $losTSpecs = ""; }
		$BrochureBulletPoints =~ s/>/&gt;/g;
		$BrochureBulletPoints =~ s/</&lt;/g;
		$BrochureBulletPoints =~ s/&#8216;/'/g;
}
$sth->execute or die "Unable to execute query\n"; 
$sth->finish;



		if ($custUName =~ "@") {
			if ($custTipo eq "MasterDist") { $lePrice = "$SavedMasterDist"; }
			elsif ($custTipo eq "Distributor") { $lePrice = "$SavedDistributor"; }
			elsif ($custTipo eq "Dealer") { $lePrice = "$SavedDealer"; }
			elsif ($custTipo eq "LawEnforce") { $lePrice = "$SavedLawEnforce"; }
			else { $lePrice = "$SavedRetail"; }
		}
		elsif ($Cookies{'Logged'} eq "SI") {
			if ($Cookies{'CT'} eq "MasterDist") { $lePrice = "$SavedMasterDist"; }
			elsif ($Cookies{'CT'} eq "Distributor") { $lePrice = "$SavedDistributor"; }
			elsif ($Cookies{'CT'} eq "Dealer") { $lePrice = "$SavedDealer"; }
			elsif ($Cookies{'CT'} eq "LawEnforce") { $lePrice = "$SavedLawEnforce"; }
			else { $lePrice = "$SavedRetail"; }
		}
		else { $lePrice = "$SavedRetail"; }

		
		if ($SpecialDiscount ne "0" && $SpecialDiscount ne "" && $SpecialDiscount ne "0.00") {
			$centuri = $lePrice / 100;
			$discountAmount = $centuri * $SpecialDiscount;
			$newPrice = $lePrice - $discountAmount;

			$lePrice=&format_money($lePrice);
			$newPrice=&format_money($newPrice);
			$SpecialDiscount=&format_money($SpecialDiscount);
			$myPrice = "<font style=\"color:#999999;font-size:10px;line-height:20px;\"><b>List Price</b> \$$lePrice<font></font><br><font style=\"color:#eb0000;font-size:12px;\"><b>Sale Price \$$newPrice</b></font></font>";
			$thisPrice = "<font style=\"color:#000000;cursor:hand;\" title=\"Sale Item Price\">\$$newPrice</font>";
			$myStyler = "style=\"color:#000000;cursor:hand;\"";
		}
		else {
			$newPrice=&format_money($lePrice);
			$myPrice = "<b>List Price</b> \$$newPrice";
			$thisPrice = "\$$newPrice";
		}
		
		
		if ($thisPrice eq "\$0.00") {
			$countZeros++;
			$myPrice = "<font style=\"color:#eb0000;cursor:hand;\" title=\"For pricing call US Night Vision toll-free: 1(800)500-4020\">Call for Pricing</font>";
			$thisPrice = "<font style=\"color:#eb0000;cursor:hand;\" title=\"For pricing call US Night Vision toll-free: 1(800)500-4020\">Call</font>";
		}
		
		
@noEnDesc = split(/\n/,$SavedDescription);
$muacount=0;
foreach $estedesc (@noEnDesc) {
	if ($muacount == 1) { 
		push(@MuaDesc,"$estedesc"); 
	}
	elsif ($muacount > 0 ) {
		push(@MuaDesc,"$estedesc<br>");
	}
	$muacount++; 
}

$MuaDesc = @MuaDesc;




if ($SavedProductType =~ "Weapon" || $SavedProductType =~ "Binocular" || $SavedProductType =~ "Monocular" || $SavedProductType =~ "Goggle") {
	$subDesc = "";
}
else {
	$subDesc = $noEnDesc[0];
}





if ($SavedLargePhoto ne "" && $SavedLargePhoto ne " ") { 
	my $sth = $dbh->prepare("SELECT * FROM newImages WHERE ImageID='$SavedLargePhoto';");
	$sth->execute or die "Unable to execute query\n"; 
	my @row;
		while(@row = $sth->fetchrow_array) { 
			$FileName = $row[2];
			$count++;
	}
	$sth->execute or die "Unable to execute query\n"; 
	$sth->finish;

	$leP = "Night_Vision_Images/Night_Vision_Products_2008/$FileName";

	$fileTotalPath = "/usr/local/www/vhosts/usnightvision.com/htdocs/" . $leP;
	##-- only if it actual exists by this point do we add to DB
	if (-e $fileTotalPath) {

		use Imager;
		my $img = Imager->new;
		$img->read(file => $fileTotalPath);

		$LPwidth = $img->getwidth();
		$LPheight = $img->getheight();	
		$LPheightL = "$LPheight" . "px";
		$LPwidthL = "$LPwidth" . "px";
	}	

}
else { 
	$leP = "Night_Vision_Images/spacer.gif"; 
}



if ($SavedProductType =~ ",") { 
	@splitPT = split(/,/,$SavedProductType);
	$thyPT = $splitPT[0];
}
else {
	$thyPT = $SavedProductType;
}

## --> COLORING
if ($thyPT eq "Binocular" || $thyPT eq "Weapon" || $thyPT eq "BodyArmor") {
	$colordark = "#90A290";
	$colorlight = "#C3CCC3";
}
elsif ($thyPT eq "Accessory" || $thyPT eq "Monocular") {
	$colordark = "#CDCCB1";
	$colorlight = "#E6E5D8";
}
elsif ($thyPT eq "Goggle" || $thyPT eq "Thermal" || $thyPT eq "Infrared" || $thyPT eq "Laser") {
	$colordark = "#BDC0C2";
	$colorlight = "#DDE0E3";
}

if ($thyPT eq "Infrared" || $thyPT eq "Digital") { $thyPT = "Thermal"; }

## --> TopBanner
# $myTopBanner = "<tr><td><img src=\"Night_Vision_Images/Night_Vision_Products/browseHeader_$thyPT.jpg\" border=\"0\" width=\"778\" height=\"107\"></td></tr>";










push(@losTS,"<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"margin-top:25px;margin-bottom:10px;\">");

if ($SavedTechSpecs =~ ":::::") {
	@splitSpecs = split(/\n\b/,$SavedTechSpecs);
	$countthis=0;
	foreach $esteSpec (@splitSpecs) {
		$countthis++;
		@esteSplit = split(/:::::/,$esteSpec);
		if ($esteSpec ne 0) { push(@losTS,"<tr><td align=\"right\" nowrap><font class=\"specs\">$esteSplit[0]</font></td><td align=\"center\" nowrap><img src=\"Night_Vision_Images/specsSplitter.gif\" width=\"11\" height=\"11\" hspace=\"10\"></td><td align=\"left\" nowrap><font class=\"specs\">$esteSplit[1]</font></td></tr>"); }
	}
}
else { push(@losTS,"<tr><td width=\"100%\" align=\"center\" nowrap><font class=\"specs\">: no product specs :</font></td></tr>"); }

push(@losTS,"</table>");









$trueItemName = $SavedItemName;

print qq~
	

<script language="javascript" src="NightVisionScripts/popwindow.js"></script>
<script language="Javascript" src="NightVisionScripts/runBrochureWindow.js"></script>
<script language="Javascript" src="NightVisionScripts/mousetable.js"></script>






<center>
<table width="535" border="0" cellspacing="0" cellpadding="0" id="Producto">
	<form action="$whichCART" name="iViewer" method="post">
  	<tr>
    	<td colspan="8"><img src="Night_Vision_Images/spacer.gif" width="1" height="1"></td>
  	</tr>
  	<tr>
    	<td width="100%" height="100%" valign="bottom" style="padding-bottom:1px;"><font class="title">$SavedItemName</font></td>
    	<td width="32" align="center" valign="bottom" style="padding-bottom:1px;padding-right:10px;padding-left:12px;"><a href="cart.htm?PID_$PID=$PID" title="Click to add this product to your cart"><img src="NightVisionImages/topIcon_purchase.gif" width="20" height="23" border="0"></a></td>
    	<td align="center" valign="bottom"><img src="Night_Vision_Images/inventoryLiner.gif" width="1" height="11"></td>
    	<td width="65" align="center" valign="bottom"><a href="brochure.htm?PID=$PID&format=PDF" target="printProduct" onClick="toggleMyPrint('PDF','$PID');" title="Click to view printer friendly PDF Brochure"><img src="NightVisionImages/topIcon_print.gif" width="20" height="20" style="margin-left:10px;margin-right:10px;margin-bottom:2px;" border="0"></a></td>
    	<td align="center" valign="bottom"><img src="Night_Vision_Images/inventoryLiner.gif" width="1" height="11"></td>
    	<td width="65" align="center" valign="bottom"><a href="Product_Brochures.htm?PID=$PID" title="Click to E-mail PDF brochure of this product to yourself or someone else"><img src="NightVisionImages/topIcon_email.gif" width="25" height="29" style="margin-left:10px;margin-right:5px;" border="0"></a></td>
    	<td align="center" valign="bottom"><img src="Night_Vision_Images/inventoryLiner.gif" width="1" height="11"></td>
    	<td width="65" align="center" valign="bottom"><a href="Product_Brochures.htm?PID=$PID" title="Click to E-mail a PDF brochure of this product to yourself for you to save"><img src="NightVisionImages/topIcon_save.gif" width="29" height="17" style="margin-left:10px;margin-right:10px;margin-bottom:5px;" border="0"></a></td>
  	</tr>
  	<tr>
    	<td colspan="8" background="Night_Vision_Images/horizontalDottie.gif"><img src="Night_Vision_Images/spacer.gif" width="1" height="1"></td>
  	</tr>
  	<tr>
    	<td width="50%"><font class="subTitle">$subDesc</font></td>
    	<td width="32" align="center" valign="top" class="inventoryButtons" style="padding-right:8px;padding-left:8px;"><a href="cart.htm?PID_$PID=$PID" title="Click to add this product to your cart" class="inventoryButtons"><nobr> buy</nobr></a></td>
    	<td width="1" align="center" valign="top"><img src="Night_Vision_Images/inventoryLiner.gif" width="1" height="11"></td>
    	<td width="65" align="center" valign="top" class="inventoryButtons" style="padding-right:13px;padding-left:13px;"><a href="javascript:void(0);toggleMyPrint('PDF','$PID');" title="Click to view printer friendly PDF Brochure" class="inventoryButtons">print</a></td>
    	<td width="1" align="center" valign="top"><img src="Night_Vision_Images/inventoryLiner.gif" width="1" height="11"></td>
    	<td width="65" align="center" valign="top" class="inventoryButtons" style="padding-right:13px;padding-left:13px;"><a href="Product_Brochures.htm?PID=$PID" title="Click to E-mail PDF brochure of this product to yourself or someone else" class="inventoryButtons">email</a></td>
    	<td width="1" align="center" valign="top"><img src="Night_Vision_Images/inventoryLiner.gif" width="1" height="11"></td>
    	<td width="65" align="center" valign="top" class="inventoryButtons"><a href="Product_Brochures.htm?PID=$PID" title="Click to E-mail a PDF brochure of this product to yourself for you to save" class="inventoryButtons">save</a></td>
  	</tr>
	<tr>
    	<td colspan="8"><img src="Night_Vision_Images/spacer.gif" width="1" height="5"></td>
	</tr>
</table>
	
<table width="550" border="0" cellspacing="0" cellpadding="0">
    <tr valign="top">
	  	<!--SIZO $LPwidth $LPheight -->
    	<td align="left"><div style="margin-top:30px;margin-bottom:30px;width:550px;height:$LPheightL;overflow:hidden;clip:rect(0px 550px $LPheightL 0px);"><img src="$leP" width="$LPwidth" height="$LPheight" border="0"></div></td>
	</tr>
</table>

<table width="535" border="0" cellspacing="0" cellpadding="0">
	<tr valign="top">
		<td align="center">
		
			<table width="100%"  border="0" cellspacing="0" cellpadding="0">
          		<tr>
            		<td height="1" colspan="3" bgcolor="#FFFFFF"><img src="Night_Vision_Images/spacer.gif" width="1" height="1"></td>
            	</tr>
				<tr>
					<td height="25" colspan="3">
			
						<table border="0" width="535" cellpadding="0" cellspacing="0" style="background-image:url(NightVisionImages/tableTitles_productDescription.gif); background-repeat:no-repeat; background-position:top left;">
							<tr valign="bottom">
								<td width="250"><div style="width:250px;height:24px;overflow:hidden;clip:rect(0px 250px 24px 0px);"></div></td>
								<td align="right" style="padding-right:3px;">

									<table border="0" cellpadding="0" cellspacing="0">
										<tr>
											<td>

												<table border="0" cellpadding="0" cellspacing="0" class="productTabs">
													<tr height="19" valign="bottom">
														<td><img src="NightVisionImages/tablesides_left.gif" width="10" height="19" border="0"></td>
														<td class="ptabs"><a href="javascript:toggleTab('tech');" style="text-decoration:none;"><div id="tech" style="color:#000000;" onmouseover="moverTabs(this,'tech');" onmouseout="moutTabs(this,'tech');">Tech Specs</div></a></td>
														<td><img src="NightVisionImages/tablesides_right.gif" width="10" height="19" border="0"></td>
													</tr>
												</table>

											</td>
											<td style="padding-left:5px;padding-right:4px;">

												<table border="0" cellpadding="0" cellspacing="0" class="productTabs">
													<tr height="19" valign="bottom">
														<td><img src="NightVisionImages/tablesides_left.gif" width="10" height="19" border="0"></td>
														<td class="ptabs"><a href="javascript:toggleTab('war');" style="text-decoration:none;"><div id="war" style="color:#718255;" onmouseover="moverTabs(this,'war');" onmouseout="moutTabs(this,'war');">Warranty</div></a></td>
														<td><img src="NightVisionImages/tablesides_right.gif" width="10" height="19" border="0"></td>
													</tr>
												</table>
						
											</td>
						<!--
											<td style="padding-left:2px;padding-right:2px;">
												<table border="0" cellpadding="0" cellspacing="0" class="productTabs">
													<tr height="19" valign="bottom">
														<td><img src="NightVisionImages/tablesides_left.gif" width="10" height="19" border="0"></td>
														<td class="ptabs"><a href="javascript:toggleTab('que');" style="text-decoration:none;"><div id="que" style="color:#718255;" onmouseover="moverTabs(this,'que');" onmouseout="moutTabs(this,'que');">Questions?</div></a></td>
														<td><img src="NightVisionImages/tablesides_right.gif" width="10" height="19" border="0"></td>
													</tr>
												</table>
											</td>
								-->
										</tr>
									</table>				
								
								</td>
							</tr>
							<tr>
								<td colspan="2" height="1"><div style="width:1px;height:1px;overflow:hidden;clip:rect(0px 1px 1px 0px);"></div></td>
							</tr>
						</table>
		
			
			
			
						</td>
            		</tr>
          			<tr valign="top">
            			<td width="300">
							<table width="100%"  border="0" cellspacing="0" cellpadding="0">
								<!--
								<tr valign="top">
                					<td style="padding-left:15px;padding-top:10px;padding-bottom:10px;"><font class="PriceWarranty">$myPrice</font></td>
                					<td align="right" style="padding-right:15px;padding-top:10px;padding-bottom:10px;"><font class="PriceWarranty"><b>Warranty</b> $DaWarranty</font></td>
		            			</tr>
								-->
								<tr align="left" valign="top">
		                			<td colspan="2" style="padding-left:15px;padding-right:15px;padding-bottom:15px;"><div class="descriptionProduct">@MuaDesc</div></td>
		        				</tr>
        					</table>
            			</td>
						<td width="1"><img src="Night_Vision_Images/spacer.gif" width="1" height="1"></td>
            			<td width="240" align="left" valign="top">
							<table width="100%" border="0" cellspacing="0" cellpadding="0">
							 	<tr>
									<td align="center" style="background:url(NightVisionImages/extrainfoBacker.gif);background-repeat:repeat-y;"><div id="dynoLayer" style="visibility:visible;width:240px;overflow-x:hidden;"><center>@losTS</center></div></td>
								</tr>
							</table>
						
							<table width="240"  border="0" cellspacing="0" cellpadding="0">
								<tr>
									<td align="center" style="background:url(NightVisionImages/extrainfoBacker.gif);background-repeat:repeat-y;"><img src="NightVisionImages/buyithereTitle_trans.gif" width="240" height="47" border="0" name="buyithereTitle"></td>
								</tr>
								<tr>
									<td align="center" style="padding-top:10px;padding-bottom:10px;background-image:url(NightVisionImages/buyithereBacker.gif);background-repeat:repeat-y;">
				


~;



print "<table width=\"100%\"  border=\"0\" cellspacing=\"0\" cellpadding=\"0\">";
print "<tr valign=\"top\"><td width=\"20\" style=\"padding-right:3px;padding-left:3px;\"><input type=\"checkbox\" name=\"PID_$PID\" value=\"$PID\" checked readonly></td><td width=\"100%\" style=\"padding-bottom:5px;\"><font class=\"shopSelectName\"><b>$SavedItemName</b></font></td><td style=\"padding-right:3px;\"><font class=\"shopSelectPrice\" $myStyler><b>$thisPrice</b></font></td></tr>";



if ($ProductOptions =~ ":::::") {
	@splitPO = split(/\n\b/,$ProductOptions);
	$cPOs = 0;

	$hasNOCOSTopt = 0;
	$stopParsingSelected = 0;
	if ($ProductOptions =~ "0.00") { $hasNOCOSTopt = 1; }
	else { $hasNOCOSTopt = 0; }
	
	foreach $PO (@splitPO) {
		@aPO = split(/:::::/,$PO);
			
		if ($PO ne 0) { 
		
			# print "<script>alert('$hasNOCOSTopt  $cPOs  $aPO[1]  $stopParsingSelected');</script>";
			if ($hasNOCOSTopt eq "1" && $aPO[1] eq "0.00" && $stopParsingSelected eq "0") { 
				$cualCheck = "brochureCheckbox1";
				$checkedORnot = "checked";
				$stopParsingSelected++; 
			}
			else { 
				$cualCheck = "brochureCheckbox0";
				$checkedORnot = "";
			}

			
			$cPOs++;
			$aPO[1]=&format_money($aPO[1]);
			$mOPT = "OPT" . $cPOs;
			
			push(@todosNamedOptionsUpgrades,"$aPO[0]");

			print qq~

			<tr valign=\"top\">
				<td colspan=\"2\" style=\"padding-bottom:5px;\" nowrap>
					<input type="checkbox" name="OPT_$cPOs" value="$aPO[0]:::::$aPO[1]" style="visibility:hidden" $checkedORnot>
					<a href="javascript:toggleCheckbox('OPT_$cPOs');" id="OPT_$cPOs" tabindex="5"><img src="Night_Vision_Images/$cualCheck.gif" border="0" width="10" height="12" name="OPT_$cPOs"></a>
					<a href="javascript:toggleCheckbox('OPT_$cPOs');" tabindex="5" class=\"shopSelectName2\"><font class=\"shopSelectName2\" title=\"Product Option/Upgrade\" style=\"cursor:hand;\"><b>$aPO[0]</b></font></a>
				</td>
				<td align=\"right\" style=\"padding-right:3px;\">
					<a href="javascript:toggleCheckbox('OPT_$cPOs');" class=\"shopSelectPrice2\"><font class=\"shopSelectPrice2\" title=\"Product Option/Upgrade\" $myStyler><b>+ $aPO[1]</b></font></a>
				</td>
			</tr>
			~;
		}
		

		
	}
}


		if ($cPOs ne "0") {
			
			print qq~
				<script language="Javascript">
				<!--

				// IMAGE PRELOADER
				check0 = new Image();
				check0.src = "Night_Vision_Images/brochureCheckbox0.gif";
				check1 = new Image();
				check1.src = "Night_Vision_Images/brochureCheckbox1.gif";

				function tCheck(incoming) {
					if (incoming.checked == 1) { incoming.checked = 0; }
					else { incoming.checked = 1; }
				}

				function toggleCheckbox(incoming) {
				
					//CLEAR ALL OTHERS
			~;

			
			$ccPO = 0;
			for (1 .. $cPOs) {
				$ccPO++;
				$myField = "otroField" . $ccPO;
				$myOPT = "OPT_" . $ccPO;
				print qq~
					var $myField = document.iViewer.$myOPT;
					$myField.checked = 0;
					document.images["OPT_$ccPO"].src = check0.src;
				~;
			}



			
			print qq~	
					

					// CHOOSE SELECTED
					var leNombre = incoming;
					var elOtro = "";
					var muaField = document.iViewer[leNombre];
					muaField.checked = 1;
					document.images[leNombre].src = check1.src;

				//	var otroField = document.iViewer[elOtro];
				//	otroField.checked = 0;
				//	document.images[elOtro].src = check0.src;


				}

				//-->
				</script>			
			~;
		}



@Accessories = split(/,/, $SavedAccessories);
if (@Accessories) {
	$countACCS = 0;
	foreach $Accessory (@Accessories) {
		my $sth = $dbh->prepare("SELECT * FROM ProductsNEW WHERE ProductID = '$Accessory'");
		$sth->execute or die "Sorry, that Username/Password combination is incorrect, please try again.\n"; 
		my $row = $sth->fetchrow_arrayref; 

			my $ThyProductID = $row->[0];
			my $ThyItemName = $row->[3];
			my $ThyDescript = $row->[4];
			my $ThySmallPhoto = $row->[6];
			my $ThyProductType = $row->[27];
			my $ThySpecialDiscount = $row->[30];

			if ($custUName =~ "@") {
				## NOW YOU KNOW
				if ($custTipo eq "MasterDist") { $muaPrice = $row->[12]; }
				elsif ($custTipo eq "Distributor") { $muaPrice = $row->[13]; }
				elsif ($custTipo eq "Dealer") { $muaPrice = $row->[14]; }
				elsif ($custTipo eq "LawEnforce") { $muaPrice = $row->[15]; }
				else { $muaPrice = $row->[16]; }
			}
			elsif ($Cookies{'Logged'} eq "SI") {
				if ($Cookies{'CT'} eq "MasterDist") { $muaPrice = $row->[12]; }
				elsif ($Cookies{'CT'} eq "Distributor") { $muaPrice = $row->[13]; }
				elsif ($Cookies{'CT'} eq "Dealer") { $muaPrice = $row->[14]; }
				elsif ($Cookies{'CT'} eq "LawEnforce") { $muaPrice = $row->[15]; }
				else { $muaPrice = $row->[16]; }
			}
			else { $muaPrice = $row->[16]; }
			$sth->finish;

				
			if ($ThySpecialDiscount ne "0" && $ThySpecialDiscount ne "" && $ThySpecialDiscount ne "0.00") {
				$centuri = $muaPrice / 100;
				$discountAmount = $centuri * $ThySpecialDiscount;
				$TnewPrice = $muaPrice - $discountAmount;
				$TnewPrice=&format_money($TnewPrice);
				$muaDollar = "<font style=\"color:#eb0000;cursor:hand;\" title=\"Sale Item Price\">$TnewPrice</font>";
				$muaDollarACC = "Sale Priced: \$$muaPrice \$$muaDollar";
			}
			else {
				$newPrice=&format_money($muaPrice);	
				$muaDollar = $newPrice;
				$muaDollarACC = "Priced: \$$muaDollar";
			}
				
			if ($muaDollar eq "0.00") {
				$countZeros++;
				$muaDollar = "<font style=\"color:#eb0000;cursor:hand;\" title=\"For pricing call US Night Vision toll-free: 1(800)500-4020\">Call</font>";
				$muaDollarACC = "Price: $muaDollar";
			}
			else {
				$muaDollar = "+ " . $muaDollar;
			}
			


			## $ThyProductID =~ s/0/_/g;
			print "<tr><td width=\"20\" style=\"padding-right:3px;padding-left:3px;\"><input type=\"checkbox\" name=\"PID_$ThyProductID\" value=\"$ThyProductID\"></td><td width=\"100%\"><a href=\"javascript:void(0);\" onClick=\"tCheck(document.forms[0].PID_$ThyProductID);\" class=\"shopSelectName2\"><font class=\"shopSelectName2\" title=\"Product Accessory Selection\n[ $ThyItemName ]\" style=\"cursor:hand;\">$ThyItemName</font></a></td><td align=\"right\" style=\"padding-right:3px;\" nowrap><a href=\"javascript:void(0);\" onClick=\"tCheck(document.forms[0].PID_$ThyProductID);\" class=\"shopSelectName2\"><font class=\"shopSelectPrice2\" title=\"Product Accessory Selection\n[ $ThyItemName ]\" style=\"cursor:hand;\">$muaDollar</font></a></td></tr>";

			##-- last 2 accessories -> prolly best items listed as accessories
			if ($countACCS < 2) {
				@noEnTD = split(/\n/,$ThyDescript);
				$MuaTD = $noEnTD[0];


				if ($ThySmallPhoto ne "" && $ThySmallPhoto ne " ") { 
					my $sth = $dbh->prepare("SELECT ImageID, FileName FROM newImages WHERE ImageID='$ThySmallPhoto';");
					$sth->execute or die "Sorry, that Username/Password combination is incorrect, please try again.\n"; 
					my $row = $sth->fetchrow_arrayref; 
					$FilaMia = $row->[1];
					$sth->finish;

					$thyImagen = "Night_Vision_Images/Night_Vision_Products_2008/$FilaMia";
					$filapath = "/usr/local/www/vhosts/usnightvision.com/htdocs/" . $thyImagen;
				}
				else { 
					$thyImagen = "Night_Vision_Images/spacer.gif"; 
				}

				##-- define product page using definePL.nsp
				$accPagina = $thePpages{$ThyProductType};
				
				push(@firstTwoACCS,"<table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"cursor:hand;margin-top:5px;\" onClick=\"document.location.href='$accPagina?q=$ThyItemName';\"><tr><td rowspan=\"3\" style=\"padding:2px;padding-left:10px;padding-right:10px;\"><a href=\"$accPagina?q=$ThyItemName\"><img src=\"$thyImagen\" border=\"0\" width=\"60\" height=\"43\"></a></td><td class=\"accessoryPreviewTitle\" width=\"100%\"><a href=\"$accPagina?q=$ThyItemName\" class=\"accessoryPreviewTitle\">$ThyItemName</a></td></tr><tr><td class=\"accessoryPreviewSubTitle\">$MuaTD</td></tr><tr><td class=\"accessoryPreviewCost\">$muaDollarACC</td></tr></table>");
			}
			$countACCS++;

	#-	}
	#-	$sth->finish;


	}
}

		if ($countZeros ne "0") { $submitDisable = "title=\"Since one or more selected items don't have a listed price, you should call us to price and order these items.\" disabled"; }
		else { $submitDisable = ""; }
		
print "</table>";




#### -->> GET RELATIVE PRODUCTS TABLE
$passNonPDFmarker = 1;
$otherProductsTable = 1;

if ($thyPT eq "Monocular") { $Monocular = 1; }
elsif ($thyPT eq "Goggle") { $Goggle = 1; }
elsif ($thyPT eq "Binocular") { $Binocular = 1; }
elsif ($thyPT eq "Weapon") { $Weapon = 1; }
elsif ($thyPT eq "Thermal") { $Thermal = 1; }
elsif ($thyPT eq "Infrared") { $Infrared = 1; }
elsif ($thyPT eq "Accessory") { $Accessory = 1; }
elsif ($thyPT eq "BodyArmor") { $BodyArmor = 1; }
elsif ($thyPT eq "Laser") { $Lasers = 1; }

require ("ppsd.nsp");

$muaTables = $mProdTable . "" . $gProdTable . "" . $bProdTable . "" . $wProdTable . "" . $tProdTable . "" . $aProdTable . "" . $baProdTable . "" . $lProdTable;

print qq~




				
				
									</td>
								</tr>

              					<tr>
									<td align="center" valign="middle" style="background-image:url(NightVisionImages/buyithereBottom.gif); background-position:top left; background-repeat:no-repeat;" height="46"><input type="submit" class="addToCartBut" value="" title="Add checked items to your shopping cart" $submitDisable></td>
								</tr>
            				</table>
			
							<table width="100%" border="0" cellspacing="0" cellpadding="0" class="tabies">
								<tr>
									<td align="center" valign="middle"><div style="padding-top:8px; width:240px; height:30px;" class="tabieTexts">Questions? Ask an Expert! ( <a href="Contact_USNV.htm?mySub=Question regarding the $trueItemName" class="tabieTexts">Ask</a> )</div></td>
								</tr>
							</table>

							<table width="100%" border="0" cellspacing="0" cellpadding="0" class="tabies">
								<tr>
									<td align="center" valign="middle"><div style="padding-top:8px; width:240px; height:30px;" class="tabieTexts">Email Product Info to Friend: ( <a href="Product_Brochures.htm?PID=$PID" class="tabieTexts">Yes</a> )</div></td>
								</tr>
							</table>

							<table width="100%" border="0" cellspacing="0" cellpadding="0" class="tabies">
								<tr>
									<td align="left" valign="top"><div style="padding-top:5px; padding-left:6px; width:240px; height:30px;" class="tabieTexts"><a href="$GSALINK" class="tabieTexts"><img src="NightVisionImages/gsa_buydirect.gif" width="229" height="20" border="0"></a></div></td>
								</tr>
							</table>
						</td>
          			</tr>
        		</table>
			</td>
    	</tr>
		<tr>
			<td align="center">



~;


if (int(@firstTwoACCS) > 0) {
	if (int(@firstTwoACCS) == 2) { $isf = "<td width=\"50%\">$firstTwoACCS[0]</td><td width=\"50%\">$firstTwoACCS[1]</td>"; }
	else { $isf = "<td width=\"100%\">$firstTwoACCS[0]</td>"; }
	$tablita = "<table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tr>$isf</tr></table>";
	print qq~
			<table border="0" width="535" cellpadding="0" cellspacing="0" style="margin-top:35px; background-image:url(NightVisionImages/tableTitles_accessories.gif); background-repeat:no-repeat; background-position:top left;">
				<tr valign="bottom">
					<td width="535"><div style="width:535px;height:25px;overflow:hidden;clip:rect(0px 535px 25px 0px);"></div></td>
				</tr>
				<tr>
					<td class="expansionPack">$tablita</td>
				</tr>
			</table>
	~;
}




if (@todosNamedOptionsUpgrades) {

	$totalTNOU = int(@todosNamedOptionsUpgrades);
	$cTNOU = 0;
	$splitta = ",";
	foreach $untnou (@todosNamedOptionsUpgrades) {
		$cTNOU++;
		if ($cTNOU == $totalTNOU) { $splitta = " and"; }
		if ($tNOU) { $tNOU = $tNOU . "$splitta " . "<i class=\"expansionBold\">$untnou</i>"; }
		else { $tNOU = "<i class=\"expansionBold\">$untnou</i>"; }
	}
	

print qq~

			<table border="0" width="535" cellpadding="0" cellspacing="0" style="margin-top:35px; background-image:url(NightVisionImages/tableTitles_upgradesOptions.gif); background-repeat:no-repeat; background-position:top left;">
				<tr valign="bottom">
					<td width="535"><div style="width:535px;height:25px;overflow:hidden;clip:rect(0px 535px 25px 0px);"></div></td>
				</tr>
				<tr>
					<td class="expansionPack">The following upgrades & options are available for the <b>$trueItemName</b> optical system: <font class="expansionBold" style="font-weight:normal;">$tNOU</font> respectively. To select an upgrade or option simply click the checkbox [ <img src="Night_Vision_Images/brochureCheckbox0.gif" border="0" width="10" height="12" alt="US Night Vision checkbox example" onMouseOver="javascript:this.src = 'Night_Vision_Images/brochureCheckbox1.gif';" onMouseOut="javascript:this.src = 'Night_Vision_Images/brochureCheckbox0.gif';"> ] next to the upgrade or option of your choice. You can find these options within the highlighted 'Buy it here!' section of this page.</td>
				</tr>
			</table>
~;

}


if ($DaWarranty != "") {
print qq~
			<table border="0" width="535" cellpadding="0" cellspacing="0" style="margin-top:35px; background-image:url(NightVisionImages/tableTitles_warranty.gif); background-repeat:no-repeat; background-position:top left;">
				<tr valign="bottom">
					<td width="535"><div style="width:535px;height:25px;overflow:hidden;clip:rect(0px 535px 25px 0px);"></div></td>
				</tr>
				<tr>
					<td class="expansionPack">Purchasing this product entitles you to a <font class="expansionBold">$DaWarranty Warranty</font> from the original date of purchase. At our discretion your equipment can be repaired or replaced with new or refurbished product or parts, if any product or parts are determined to be defective due to materials or workmanship. Shipping & handling not included in this warranty.<br><br>Accessories: Any accessories included with this product are also covered by this <font class="expansionBold">$DaWarranty Warranty</font>.</td>
				</tr>
			</table>			
~;
}






if (int(@allSIM) > 0) {
	use Array::PAT;
	@newSIM = shuffle(@allSIM);

	$cSIM = 0;
	foreach $losSIM (@newSIM) {
		($simid, $simpt, $simname, $simsmallphoto, $simprice) = split(/-----/,$losSIM);

		my $sth = $dbh->prepare("SELECT * FROM newImages WHERE ImageID='$simsmallphoto';");
		$sth->execute or die "Unable to execute query\n"; 
		my @row;
		while(@row = $sth->fetchrow_array) { 
			$simFN = $row[2];
			$count++;
		}
		$sth->execute or die "Unable to execute query\n"; 
		$sth->finish;

		$leSIMP = "Night_Vision_Images/Night_Vision_Products_2008/$simFN";

		$simTotalPath = "/usr/local/www/vhosts/usnightvision.com/htdocs/" . $leSIMP;
		##-- only if it actual exists do we show it
		if (-e $simTotalPath) {
			$simfile = "$leSIMP";
		}
		else {
			$simfile = "Night_Vision_Images/spacer.gif"; 
		}
	
		##-- define product page using definePL.nsp
		$myPagina = $thePpages{$simpt};


		if ($cSIM == 0) { $SIM1 = "<table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"cursor:hand;margin-top:5px;\" onClick=\"document.location.href='$myPagina?q=$simname';\"><tr><td style=\"padding:10px;\" align=\"center\"><a href=\"$myPagina?q=$simname\"><img src=\"$simfile\" border=\"0\" width=\"125\" height=\"90\"></a></td><tr><td class=\"accessoryPreviewTitle\" width=\"100%\" align=\"center\"><a href=\"$myPagina?q=$simname\" class=\"similarPreviewTitle\">$simname</a></td></tr><tr><td class=\"similarPreviewCost\" align=\"center\">$simprice</td></tr></table>"; }
		elsif ($cSIM == 1) { $SIM2 = "<table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"cursor:hand;margin-top:5px;\" onClick=\"document.location.href='$myPagina?q=$simname';\"><tr><td style=\"padding:10px;\" align=\"center\"><a href=\"$myPagina?q=$simname\"><img src=\"$simfile\" border=\"0\" width=\"125\" height=\"90\"></a></td><tr><td class=\"accessoryPreviewTitle\" width=\"100%\" align=\"center\"><a href=\"$myPagina?q=$simname\" class=\"similarPreviewTitle\">$simname</a></td></tr><tr><td class=\"similarPreviewCost\" align=\"center\">$simprice</td></tr></table>"; }
		elsif ($cSIM == 2) { $SIM3 = "<table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"cursor:hand;margin-top:5px;\" onClick=\"document.location.href='$myPagina?q=$simname';\"><tr><td style=\"padding:10px;\" align=\"center\"><a href=\"$myPagina?q=$simname\"><img src=\"$simfile\" border=\"0\" width=\"125\" height=\"90\"></a></td><tr><td class=\"accessoryPreviewTitle\" width=\"100%\" align=\"center\"><a href=\"$myPagina?q=$simname\" class=\"similarPreviewTitle\">$simname</a></td></tr><tr><td class=\"similarPreviewCost\" align=\"center\">$simprice</td></tr></table>"; }
		$cSIM++;
	}

	if (int(@allSIM) >= 3) { $sim = "<td width=\"33%\">$SIM1</td><td width=\"33%\">$SIM2</td><td width=\"33%\">$SIM3</td>"; }
	elsif (int(@allSIM) == 2) { $sim = "<td width=\"50%\">$SIM1</td><td width=\"50%\">$SIM2</td>"; }
	else { $sim = "<td width=\"100%\">$SIM1</td>"; }

	$tablita2 = "<table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tr>$sim</tr></table>";

	print qq~
	
			<table border="0" width="535" cellpadding="0" cellspacing="0" style="margin-top:35px; background-image:url(NightVisionImages/tableTitles_similar.gif); background-repeat:no-repeat; background-position:top left;">
				<tr valign="bottom">
					<td width="535"><div style="width:535px;height:25px;overflow:hidden;clip:rect(0px 535px 25px 0px);"></div></td>
				</tr>
				<tr>
					<td class="expansionPack">$tablita2</td>
				</tr>
			</table>
	~;
}




print qq~
			
			
		</td>
	</tr>
</form>
</table>
	

<br><br>


$muaTables

<br><br>
</center>







<div style="visibility:hidden;width:1px;height:1px;overflow:hidden;clip:rect(0px 1px 1px 0px);" id="blankLayer"><center><img src="NightVisionImages/spacer.gif" width="1" height="1" border="0"></center></div>
<div style="visibility:hidden;width:1px;height:1px;overflow:hidden;clip:rect(0px 1px 1px 0px);" id="warLayer"><center><img src="NightVisionImages/usnv-warranty.gif" width="210" height="163" border="0" style="margin-top:20px;"></center></div>
<div style="visibility:hidden;width:1px;height:1px;overflow:hidden;clip:rect(0px 1px 1px 0px);" id="queLayer">quelayer</div>
<div style="visibility:hidden;width:1px;height:1px;overflow:hidden;clip:rect(0px 1px 1px 0px);" id="techLayer">@losTS</div>





~;





$dbh->disconnect;

1;






